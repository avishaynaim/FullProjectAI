import{a as ue}from"./chunk-JWA5TSVX.js";import{d as me,m as ce,v as ge}from"./chunk-XISKUO3H.js";import{j as be,m as fe,p as he}from"./chunk-T3ONEWW3.js";import{a as de}from"./chunk-3AODB45S.js";import{a as _e}from"./chunk-YWNIUHYB.js";import{b as Y}from"./chunk-5ISOAKHE.js";import{m as ae,n as se,o as le,p as pe}from"./chunk-3WJCVL2W.js";import{a as K,b as Q}from"./chunk-QB7MGXM7.js";import{e as Z,h as $,k as ee,s as te,u as ie,v as oe,w as ne,x as re}from"./chunk-QERIUF64.js";import{$a as y,$d as G,Bb as N,Cb as F,Da as e,Ea as i,Fa as x,Ga as k,H as D,Ha as B,Ja as w,Ka as m,La as d,Nb as O,Nd as q,Pb as X,Qb as z,Sb as H,T as g,Ta as s,U as u,Ua as c,Xa as b,Ya as f,Za as h,_a as L,a as S,ab as P,b as T,be as J,dd as V,g as j,ga as l,hd as I,ib as R,jb as E,ka as v,ld as U,ma as W,ra as C,ua as _,xa as M,yb as A}from"./chunk-KTDYQ5NR.js";var Se=p=>["/projects",p],Ce=()=>[],De=()=>[10,25,50],ve=()=>({width:"500px"}),Me=()=>({width:"80vw"}),xe=p=>["/messages",p];function we(p,r){if(p&1&&(e(0,"h1",30),s(1),i()),p&2){let o=d();l(),c(o.root.name)}}function Re(p,r){p&1&&(e(0,"tr")(1,"th"),s(2,"Name"),i(),e(3,"th"),s(4,"Description"),i(),e(5,"th"),s(6,"Fields"),i(),e(7,"th"),s(8,"Created Date"),i(),e(9,"th",31),s(10,"Actions"),i()())}function Ee(p,r){if(p&1){let o=w();e(0,"tr")(1,"td"),s(2),i(),e(3,"td"),s(4),i(),e(5,"td"),s(6),i(),e(7,"td"),s(8),R(9,"date"),i(),e(10,"td")(11,"div",32),x(12,"button",33),e(13,"button",34),m("click",function(){let n=g(o).$implicit,a=d();return u(a.showEditMessageDialog(n))}),i(),e(14,"button",35),m("click",function(){let n=g(o).$implicit,a=d();return u(a.confirmDeleteMessage(n))}),i()()()()}if(p&2){let o=r.$implicit;l(2),c(o.name),l(2),c(o.description),l(2),c((o.fields==null?null:o.fields.length)||0),l(2),c(E(9,5,o.createdDate)),l(4),_("routerLink",P(7,xe,o.id))}}function Ve(p,r){p&1&&(e(0,"tr")(1,"td",36),s(2," No messages found. "),i()())}function Ie(p,r){if(p&1){let o=w();k(0),e(1,"div",37)(2,"div",38)(3,"label",39),s(4,"Name"),i(),e(5,"input",40),h("ngModelChange",function(n){g(o);let a=d();return f(a.editingRoot.name,n)||(a.editingRoot.name=n),u(n)}),i()(),e(6,"div",38)(7,"label",41),s(8,"Description"),i(),e(9,"textarea",42),h("ngModelChange",function(n){g(o);let a=d();return f(a.editingRoot.description,n)||(a.editingRoot.description=n),u(n)}),i()(),e(10,"div",15)(11,"button",43),m("click",function(){g(o);let n=d();return u(n.rootDialogVisible=!1)}),i(),e(12,"button",44),m("click",function(){g(o);let n=d();return u(n.saveRoot())}),i()()(),B()}if(p&2){let o=d();l(5),b("ngModel",o.editingRoot.name),l(4),b("ngModel",o.editingRoot.description)}}function Te(p,r){if(p&1){let o=w();k(0),e(1,"div",37)(2,"div",38)(3,"label",45),s(4,"Name"),i(),e(5,"input",46),h("ngModelChange",function(n){g(o);let a=d();return f(a.editingMessage.name,n)||(a.editingMessage.name=n),u(n)}),i()(),e(6,"div",38)(7,"label",47),s(8,"Description"),i(),e(9,"textarea",48),h("ngModelChange",function(n){g(o);let a=d();return f(a.editingMessage.description,n)||(a.editingMessage.description=n),u(n)}),i()(),e(10,"div",15)(11,"button",43),m("click",function(){g(o);let n=d();return u(n.messageDialogVisible=!1)}),i(),e(12,"button",44),m("click",function(){g(o);let n=d();return u(n.saveMessage())}),i()()(),B()}if(p&2){let o=d();l(5),b("ngModel",o.editingMessage.name),l(4),b("ngModel",o.editingMessage.description)}}var ye=class p{constructor(r,o,t,n,a,ke){this.route=r;this.router=o;this.store=t;this.confirmationService=n;this.messageService=a;this.signalRService=ke}rootId="";root=null;breadcrumbs=[];rootDialogVisible=!1;editingRoot={};messageDialogVisible=!1;messageDialogHeader="";editingMessage={};isEditingMessage=!1;exportDialogVisible=!1;exportedXml="";destroy$=new j;ngOnInit(){this.route.params.pipe(D(this.destroy$)).subscribe(r=>{this.rootId=r.id,this.store.dispatch(me({id:this.rootId})),this.store.select(ue(this.rootId)).pipe(D(this.destroy$)).subscribe(o=>{o&&(this.root=o,this.breadcrumbs=[{label:"Projects",routerLink:["/projects"]},{label:"Project",routerLink:["/projects",o.projectId]},{label:o.name}],this.signalRService.joinProject(o.projectId))})})}ngOnDestroy(){this.root&&this.signalRService.leaveProject(this.root.projectId),this.destroy$.next(),this.destroy$.complete()}showEditRootDialog(){this.root&&(this.editingRoot=S({},this.root),this.rootDialogVisible=!0)}saveRoot(){if(!this.root)return;let r=T(S({},this.root),{name:this.editingRoot.name||this.root.name,description:this.editingRoot.description||this.root.description,lastModifiedDate:new Date});this.store.dispatch(ce({root:r})),this.messageService.add({severity:"success",summary:"Success",detail:"Root updated successfully"}),this.rootDialogVisible=!1}showCreateMessageDialog(){this.editingMessage={},this.messageDialogHeader="Create New Message",this.isEditingMessage=!1,this.messageDialogVisible=!0}showEditMessageDialog(r){this.editingMessage=S({},r),this.messageDialogHeader="Edit Message",this.isEditingMessage=!0,this.messageDialogVisible=!0}saveMessage(){if(this.root){if(this.isEditingMessage&&this.editingMessage.id){let r=T(S({},this.editingMessage),{lastModifiedDate:new Date});this.store.dispatch(fe({message:r})),this.messageService.add({severity:"success",summary:"Success",detail:"Message updated successfully"})}else{let r={id:"",name:this.editingMessage.name||"",description:this.editingMessage.description||"",rootId:this.rootId,createdDate:new Date,lastModifiedDate:new Date,fields:[]};this.store.dispatch(be({message:r})),this.messageService.add({severity:"success",summary:"Success",detail:"Message created successfully"})}this.messageDialogVisible=!1}}confirmDeleteMessage(r){this.confirmationService.confirm({message:`Are you sure you want to delete the message "${r.name}"?`,header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.store.dispatch(he({id:r.id})),this.messageService.add({severity:"success",summary:"Success",detail:"Message deleted successfully"})}})}exportRoot(){this.rootId&&(this.store.dispatch(ge({id:this.rootId})),this.store.select(r=>r.roots.exportedXml).pipe(D(this.destroy$)).subscribe(r=>{r&&(this.exportedXml=r,this.exportDialogVisible=!0)}))}copyToClipboard(r){navigator.clipboard.writeText(r).then(()=>{this.messageService.add({severity:"success",summary:"Success",detail:"XML copied to clipboard"})},o=>{console.error("Could not copy text: ",o),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to copy to clipboard"})})}onSearch(r){}onClearSearch(){}static \u0275fac=function(o){return new(o||p)(v(O),v(X),v(q),v(V),v(I),v(Y))};static \u0275cmp=W({type:p,selectors:[["app-root-detail"]],features:[L([I,V])],decls:56,vars:47,consts:[[1,"card"],[1,"mb-4"],[3,"breadcrumbs"],[1,"p-toolbar-group-start"],["class","text-2xl font-bold m-0",4,"ngIf"],[1,"p-toolbar-group-end"],[3,"search","clear"],["pButton","","type","button","label","New Message","icon","pi pi-plus",1,"ml-2",3,"click"],["pButton","","type","button","label","Export","icon","pi pi-download",1,"p-button-success","ml-2",3,"click"],[1,"grid","mt-4"],[1,"col-4"],["header","Root Information","styleClass","h-full"],[1,"grid"],[1,"col-4","font-bold"],[1,"col-8"],[1,"flex","justify-content-end","gap-2","mt-4"],["pButton","","type","button","icon","pi pi-arrow-left","label","Back to Project",1,"p-button-outlined",3,"routerLink"],["pButton","","type","button","icon","pi pi-pencil","label","Edit",1,"p-button-success",3,"click"],["header","Messages","styleClass","h-full"],["styleClass","p-datatable-sm p-datatable-gridlines","responsiveLayout","scroll",3,"value","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","visible","header","modal","draggable","resizable"],[4,"ngIf"],["header","Exported XML",3,"visibleChange","visible","modal","draggable","resizable"],[1,"p-3","border","rounded","bg-gray-100","overflow-auto",2,"max-height","70vh"],[1,"flex","justify-content-end","mt-4"],["pButton","","type","button","label","Copy","icon","pi pi-copy",3,"click"],["pButton","","type","button","label","Close","icon","pi pi-times",1,"p-button-outlined","ml-2",3,"click"],[1,"text-2xl","font-bold","m-0"],[2,"width","150px"],[1,"flex","gap-2"],["pButton","","type","button","icon","pi pi-eye","pTooltip","View",1,"p-button-sm","p-button-info",3,"routerLink"],["pButton","","type","button","icon","pi pi-pencil","pTooltip","Edit",1,"p-button-sm","p-button-success",3,"click"],["pButton","","type","button","icon","pi pi-trash","pTooltip","Delete",1,"p-button-sm","p-button-danger",3,"click"],["colspan","5",1,"text-center","p-4"],[1,"p-fluid"],[1,"field"],["for","rootName",1,"font-bold"],["id","rootName","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel"],["for","rootDescription",1,"font-bold"],["id","rootDescription","pInputTextarea","","rows","3",1,"w-full",3,"ngModelChange","ngModel"],["pButton","","type","button","label","Cancel",1,"p-button-outlined",3,"click"],["pButton","","type","button","label","Save",3,"click"],["for","messageName",1,"font-bold"],["id","messageName","type","text","pInputText","",1,"w-full",3,"ngModelChange","ngModel"],["for","messageDescription",1,"font-bold"],["id","messageDescription","pInputTextarea","","rows","3",1,"w-full",3,"ngModelChange","ngModel"]],template:function(o,t){o&1&&(e(0,"div",0)(1,"div",1),x(2,"app-breadcrumb",2),i(),e(3,"p-toolbar")(4,"div",3),C(5,we,2,1,"h1",4),i(),e(6,"div",5)(7,"app-search-box",6),m("search",function(a){return t.onSearch(a)})("clear",function(){return t.onClearSearch()}),i(),e(8,"button",7),m("click",function(){return t.showCreateMessageDialog()}),i(),e(9,"button",8),m("click",function(){return t.exportRoot()}),i()()(),e(10,"div",9)(11,"div",10)(12,"p-card",11)(13,"div",12)(14,"div",13),s(15,"Name:"),i(),e(16,"div",14),s(17),i(),e(18,"div",13),s(19,"Description:"),i(),e(20,"div",14),s(21),i(),e(22,"div",13),s(23,"Created:"),i(),e(24,"div",14),s(25),R(26,"date"),i(),e(27,"div",13),s(28,"Last Modified:"),i(),e(29,"div",14),s(30),R(31,"date"),i(),e(32,"div",13),s(33,"Messages:"),i(),e(34,"div",14),s(35),i()(),e(36,"div",15),x(37,"button",16),e(38,"button",17),m("click",function(){return t.showEditRootDialog()}),i()()()(),e(39,"div",14)(40,"p-card",18)(41,"p-table",19),C(42,Re,11,0,"ng-template",20)(43,Ee,15,9,"ng-template",21)(44,Ve,3,0,"ng-template",22),i()()()()(),e(45,"p-dialog",23),h("visibleChange",function(a){return f(t.rootDialogVisible,a)||(t.rootDialogVisible=a),a}),C(46,Ie,13,2,"ng-container",24),i(),e(47,"p-dialog",23),h("visibleChange",function(a){return f(t.messageDialogVisible,a)||(t.messageDialogVisible=a),a}),C(48,Te,13,2,"ng-container",24),i(),e(49,"p-dialog",25),h("visibleChange",function(a){return f(t.exportDialogVisible,a)||(t.exportDialogVisible=a),a}),e(50,"div",26)(51,"pre"),s(52),i()(),e(53,"div",27)(54,"button",28),m("click",function(){return t.copyToClipboard(t.exportedXml)}),i(),e(55,"button",29),m("click",function(){return t.exportDialogVisible=!1}),i()()()),o&2&&(l(2),_("breadcrumbs",t.breadcrumbs),l(3),_("ngIf",t.root),l(12),c(t.root==null?null:t.root.name),l(4),c(t.root==null?null:t.root.description),l(4),c(E(26,36,t.root==null?null:t.root.createdDate)),l(5),c(E(31,38,t.root==null?null:t.root.lastModifiedDate)),l(5),c((t.root==null||t.root.messages==null?null:t.root.messages.length)||0),l(2),_("routerLink",P(40,Se,t.root==null?null:t.root.projectId)),l(4),_("value",(t.root==null?null:t.root.messages)||y(42,Ce))("paginator",!0)("rows",10)("rowsPerPageOptions",y(43,De))("showCurrentPageReport",!0),l(4),M(y(44,ve)),b("visible",t.rootDialogVisible),_("header","Edit Root")("modal",!0)("draggable",!1)("resizable",!1),l(),_("ngIf",t.rootDialogVisible),l(),M(y(45,ve)),b("visible",t.messageDialogVisible),_("header",t.messageDialogHeader)("modal",!0)("draggable",!1)("resizable",!1),l(),_("ngIf",t.messageDialogVisible),l(),M(y(46,Me)),b("visible",t.exportDialogVisible),_("modal",!0)("draggable",!1)("resizable",!1),l(3),c(t.exportedXml))},dependencies:[F,A,N,te,Z,$,ee,H,z,oe,ie,U,J,G,Q,K,se,ae,re,ne,pe,le,_e,de],encapsulation:2})};export{ye as RootDetailComponent};
